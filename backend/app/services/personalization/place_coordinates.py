# 장소별 좌표 데이터
PLACE_COORDINATES = {
    # 어린이공원
    "어린이 놀이터": {"lat": 37.5934438, "lng": 127.0674375},
    "마로니에 어린이 공원": {"lat": 37.5745424, "lng": 127.0739931},
    "늘봄 어린이 공원": {"lat": 37.5713740, "lng": 127.0726104},
    "샛별 어린이 공원": {"lat": 37.5679389, "lng": 127.0675625},
    "한내 어린이 공원": {"lat": 37.5676605, "lng": 127.0707280},
    "아름드리 어린이 공원": {"lat": 37.5785901, "lng": 127.0595040},
    "활터 어린이 공원": {"lat": 37.5768133, "lng": 127.0538770},
    "우산각 어린이 공원": {"lat": 37.5737092, "lng": 127.0247380},
    "방아다리 어린이 공원": {"lat": 37.5854744, "lng": 127.0345149},

    # 일반공원
    "장안 근린 공원": {"lat": 37.5662463, "lng": 127.0740951},
    "장미 공원": {"lat": 37.5716923, "lng": 127.0691611},
    "장평 근린 공원": {"lat": 37.5669810, "lng": 127.0734044},
    "초화원": {"lat": 37.5753699, "lng": 127.0540015},
    "간데메 공원": {"lat": 37.5741524, "lng": 127.0483639},
    "용두 공원": {"lat": 37.5730693, "lng": 127.0411982},

    # 산
    "배봉산": {"lat": 37.5818810, "lng": 127.0646100},
    "천장산": {"lat": 37.6017060, "lng": 127.0504050},

    # 하천
    "정릉천": {"lat": 37.5767900, "lng": 127.0345490},
    "중랑천": {"lat": 37.6024240, "lng": 127.0721480},
    "성북천": {"lat": 37.5745720, "lng": 127.0278010},
    "청계천": {"lat": 37.5708191, "lng": 127.0274223}
}


def get_place_coordinates(place_name):
    """장소명으로 좌표 반환"""
    return PLACE_COORDINATES.get(place_name)

def get_latest_visited_coordinates(user_history):
    """사용자 히스토리에서 가장 최근 방문한 장소의 좌표 반환"""
    if not user_history or len(user_history) == 0:
        return None
    
    # 가장 최근 기록에서 장소명 추출
    latest_route = user_history[0]
    place_name = latest_route.get('title', '')
    
    # 이모지 제거
    if place_name:
        # 이모지 제거 (🟠, 🟢, 🔵 등)
        import re
        place_name = re.sub(r'[🟠🟢🔵🟡🟣🔴⚪⚫]', '', place_name).strip()
        
        # 좌표 반환
        return get_place_coordinates(place_name)
    
    return None
